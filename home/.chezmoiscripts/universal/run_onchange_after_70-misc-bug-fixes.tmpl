{{- if (eq .host.distro.family "linux") -}}
#!/usr/bin/env bash

# enabled extensions: {{ output "dconf" "read" "/org/gnome/shell/enabled-extensions" }}

{{ includeTemplate "universal/profile" }}
{{ includeTemplate "universal/logg" }}

### Fix for Ubuntu default extension conflicting with dash-to-dock
if dconf read /org/gnome/shell/enabled-extensions | grep dash-to-dock > /dev/null; then
    if [ -d '/usr/share/gnome-shell/extensions/ubuntu-dock@ubuntu.com' ]; then
        if [ ! -d /usr/share/gnome-shell/extensions/disabled ]; then
            sudo mkdir /usr/share/gnome-shell/extensions/disabled
            logg info 'Created /usr/share/gnome-shell/extensions/disabled for GNOME extensions that have issues'
        fi
        sudo mv '/usr/share/gnome-shell/extensions/ubuntu-dock@ubuntu.com' '/usr/share/gnome-shell/extensions/disabled/ubuntu-dock@ubuntu.com'
        logg info 'Moved ubuntu-dock@ubuntu.com to the disabled extension folder'
    fi
fi

### Merge latest Candy icons into the Betelgeuse icon theme
if command -v rsync > /dev/null; then
    if [ -d "$HOME/.local/src/candy-icons" ] && [ -d /usr/local/share/icons/Candy ]; then
        sudo rsync -artvu --exclude .git/ "$HOME/.local/src/candy-icons/" "/usr/local/share/icons/Candy/"
    else
        logg warn 'Skipping synchronization of Candy icons since either the target or destination folder is not present'
    fi
else
    logg warn '`rsync` is missing from the system!'
fi

##### CANDY ICONS START ######

### Additional icons
SRC="/usr/local/share/icons/Candy/apps/scalable"
TAR="/usr/local/share/icons/Candy/apps/scalable"
if [ -d "$SRC" ] && [ -d "$TAR" ]; the
    logg info 'Adding similar substitutes for some apps in the Candy icons theme'
    if [ -f "$SRC/youtube-dl-gui.svg" ]; then
        sudo cp -f "$SRC/youtube-dl-gui.svg" "$TAR/com.github.Johnn3y.Forklift.svg"
    fi
    if [ -f "$SRC/rdm.svg" ]; then
        sudo cp -f "$SRC/rdm.svg" "$TAR/app.resp.RESP.svg"
    fi
    if [ -f "$SRC/preferences-system-power.svg" ]; then
        sudo cp -f "$SRC/preferences-system-power.svg" "$TAR/org.gnome.PowerStats.svg"
    fi
    if [ -f "$SRC/software-store.svg" ]; then
        sudo cp -f "$SRC/software-store.svg" "$TAR/software-properties-gtk.svg"
    fi
fi

### Icons added to fork (https://github.com/ProfessorManhattan/candy-icons)
# These commented out icons already had good matches in the Sweet theme so a fork was created
# and a pull request was open for them.
# sudo cp -f "$SRC/gitkraken.svg" "$TAR/com.axosoft.GitKraken.svg"
# sudo cp -f "$SRC/github-desktop.svg" "$TAR/io.github.shiftey.Desktop"
# sudo cp -f "$SRC/inkscape.svg" "$TAR/inkscape_inkscape.desktop"
# sudo cp -f "$SRC/cutter.svg" "$TAR/re.rizin.cutter.svg"
# sudo cp -f "$SRC/arduino.svg" "$TAR/cc.arduino.IDE2.svg"    
# sudo cp -f "$SRC/intellij.svg" "$TAR/intellij-idea-community_intellij-idea-community.svg"
# sudo cp -f "$SRC/google-chrome.svg" "$TAR/com.google.Chrome.svg"
# sudo cp -f "$SRC/firefox.svg" "$TAR/org.mozilla.firefox.svg"
# sudo cp -f "$SRC/microsoft-edge.svg" "$TAR/com.microsoft.Edge.svg"
# sudo cp -f "$SRC/thunderbird.svg" "$TAR/org.mozilla.Thunderbird.svg"
# sudo cp -f "$SRC/postman.svg" "$TAR/com.getpostman.Postman.svg"
# sudo cp -f "$SRC/plexhometheater.svg" "$TAR/tv.plex.PlexDesktop.svg"
# sudo cp -f "$SRC/seafile.svg" "$TAR/com.client.Seafile.svg"
# sudo cp -f "$SRC/com.github.gi_lom.dialect.svg" "$TAR/app.drey.Dialect.svg"

### Missing icons
# The following applications are missing icons after using the "Full" installer. The application name
# is listed. To the right of each hyphen is the name of the `.desktop` file.
# Webkit Font Generator - 
# Lepton - lepton_lepton
# scrcpygui
# scrcpy - scrcpy_scrcpy
# Shotcut - org.shotcut.Shotcut
# Kooha - io.github.seadve.Kooha
# Lens - kontena-lens_kontena-lens
# Proton Mail Bridge - ch.protonmail.protonmail-bridge
# Proton Import-Export app - ch.protonmail.protonmail-import-export-app
# MQTTX - com.emqx.MQTTX
# Mockoon - mockoon_mockoon
# PowerShell - powershell_powershell
# GNOME Network Displays - org.gnome.NetworkDisplays
# Cockpit Client - org.cockpit_project.CockpitClient
# Yubico Authenticator - com.yubico.yubioath
# OnlyKey App - onlykey-app_onlykey-app
# Gitter - im.gitter.Gitter
# Jitsi Meet - org.jitsi.jitsi-meet
# Keybase
# Nuclear - org.js.nuclear.Nuclear
# Motrix - net.agalwood.Motrix
# Raspberry Pi Imager - org.raspberrypi.rpi-imager
# Junction - re.sonny.Junction
# GNOME Extension Manager - com.mattjakeman.ExtensionManager
# Startup Applications
# Multipass - multipass_gui

##### CANDY ICONS END ######

{{ end -}}
